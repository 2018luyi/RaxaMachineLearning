<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Raxa ML Search</title>
</head>
<script type="text/javascript">
	var ws = null;
	function sendMsg() {
		console.log("changed")
		var message = document.getElementById("query").value;
		if (ws != null) {
			ws.send('query:' + message);
		}
	}
	function learn() {
		
		if (ws != null) {
			ws.send('learn:');
		}
	}
	function connect() {

		if ("WebSocket" in window) {
			console.log("WebSocket is supported by your Browser!");
			// Let us open a web socket
			ws = new WebSocket("ws://" + window.location.host + "/RaxaMachineLearning/ml/search");
			ws.onopen = function() {
				// Web Socket is connected, send data using send()
				console.log("connected");
			};
			ws.onmessage = function(evt) {
				var msg = JSON.parse(evt.data);
				//console.log("Message is received... \n" + msg);
				printResults(msg.results)
			};
			ws.onclose = function() {
				// websocket is closed.
				console.log("Connection is closed...");
			};
		} else {
			// The browser doesn't support WebSocket
			alert("WebSocket NOT supported by your Browser!");
		}
	}
	function printResults(result) {
		console.log(result);
		var str = "";
		for(var i=0;i<result.length;i++) {
			str = str + "<div> Drug Name: " + result[i].name + ", Drug Generic: " + result[i].generic + "</div>"
		}
		document.getElementById("results").innerHTML = str;
	}
</script>
</head>
<body onload="connect()">
	<input type="text" size="35" style="font-size:25px" id="query" onkeyup="sendMsg()">
	<button id="learn" onclick="learn()">
		Learn
	</button>
	<h2>Results</h2>
	<p id="results"></p>
</body>
</html>